# 浮点运算︰ 问题和限制

一般情况下，你输入的十进制浮点数仅由实际存储在计算机中的近似的二进制浮点数表示。

注意，这是二进制浮点数的自然性质：它不是 Python 中的一个 bug ，也不是你的代码中的 bug。
你会看到所有支持硬件浮点数算法的语言都会有这个现象（尽管有些语言默认情况下或者在所有输出模式下可能不会显示出差异）。

这是因为小数以二进制形式表示时的有穷性导致的。

我们知道，将一个小数转化为二进制表示的方式是，不断的乘2，取其中的整数部分。例如：

+----------------------------------------------------------------------------------------------------------------------------------+
(1) 0.625*2 = 1.25, 整数部分为1，小数部分为0.25
(2) 0.25 * 2 = 0.5 , 整数部分为0，小数部分为0.5
(3) 0.5 * 2 = 1 , 整数部分为1，小数部分为0
+----------------------------------------------------------------------------------------------------------------------------------+

所以0.625的二进制表示就是0.101。

然而有些小数，例如0.4，并不能够精确的转化为二进制表示，用上面的这种方法计算：

+----------------------------------------------------------------------------------------------------------------------------------+
(1) 0.4*2=0.8 整数部分为0，小数部分为0.8
(2) 0.8*2=1.6 整数部分为1，小数部分为0.6
(3) 0.6*2=1.2 整数部分为1，小数部分为0.2
(4) 0.2*2=0.4 整数部分为0，小数部分为0.4

(5) 0.4*2=0.8 整数部分为0，小数部分为0.8
(6) 0.8*2=1.6 整数部分为1，小数部分为0.6
(7) 0.6*2=1.2 整数部分为1，小数部分为0.2
……
+----------------------------------------------------------------------------------------------------------------------------------+

所以0.4转化为二进制，应该是0.0110... 这样一个无限循环小数。
计算机的内存、cpu寄存器等等这些硬件单元都是有限的，只能表示有限位数的二进制位，因此存储的二进制小数就会和实际转换而成的二进制数有一定的误差。（你可以试着将0.3转化为二进制表示，也将出现一个循环小数。）
实际上，大多数情况下，小数在计算机中是以一种类似科学计数法的形式表示的，具体的可以参考一下其他的资料。但即便如此，仍然存在误差。

所以在python中不建议直接将两个浮点数进行大小比较，或者做精确的计算，往往会得到意想不到的结果。当然，如果非要用，可以参考decimal模块的相关内容。


对于需要精确十进制表示的情形

* 尝试使用decimal模块，该模块实现适用于会计应用程序和高精度应用程序的十进制算术。

* 精确算术的另一种形式由fractions模块支持，其实现基于有理数的算术（因此，可以精确表示如1/3的数字）。

* float.as_integer_ratio()方法将float的值表达为分数

如果你是浮点数操作的重度使用者，你应该看一下由SciPy项目提供的Numerical Python包和其它用于数学和统计学的包。参见<https://scipy.org>。
``` python
>>> from decimal import Decimal
>>> from fractions import Fraction

>>> Fraction.from_float(0.1)
Fraction(3602879701896397, 36028797018963968)

>>> (0.1).as_integer_ratio()
(3602879701896397, 36028797018963968)

>>> Decimal.from_float(0.1)
Decimal('0.1000000000000000055511151231257827021181583404541015625')

>>> format(Decimal.from_float(0.1), '.17')
'0.10000000000000001'
```